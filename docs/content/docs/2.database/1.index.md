---
title: Nuxt SQL Database
description: Setup your SQL database in Nuxt with Drizzle ORM, including installation, environment setup, and database connection.
navigation.title: Setup
---

NuxtHub Database provides a type-safe SQL database powered by [Drizzle ORM](https://orm.drizzle.team), supporting PostgreSQL, MySQL, and SQLite with smart detection and automatic migrations at build time.

## Getting started

::steps{level="3"}
### Install dependencies

Install Drizzle ORM, Drizzle Kit, and the appropriate driver(s) for the database you are using:

::tabs{sync="database-dialect"}
  :::tabs-item{label="PostgreSQL" icon="i-simple-icons-postgresql"}
    :pm-install{name="drizzle-orm drizzle-kit postgres @electric-sql/pglite"}
    ::callout
    NuxtHub automatically detects your database connection using environment variables:
    - Uses `PGlite` (embedded PostgreSQL) if no environment variables are set.
    - Uses `postgres-js` driver if you set `DATABASE_URL`, `POSTGRES_URL`, or `POSTGRESQL_URL` environment variable.
    - Use `neon-http` driver with `@neondatabase/serverless` for [Neon](https://neon.com) serverless PostgreSQL.
    ::
  :::
  :::tabs-item{label="MySQL" icon="i-simple-icons-mysql"}
    :pm-install{name="drizzle-orm drizzle-kit mysql2"}
    ::callout
    NuxtHub automatically detects your database connection using environment variables:
    - Uses `mysql2` driver if you set `DATABASE_URL` or `MYSQL_URL` environment variable.
    - Requires environment variable (no local fallback)
    ::
  :::
  :::tabs-item{label="SQLite" icon="i-simple-icons-sqlite"}
    :pm-install{name="drizzle-orm drizzle-kit @libsql/client"}
    ::callout
    NuxtHub automatically detects your database connection using environment variables:
    - Uses `libsql` driver for [Turso](https://turso.tech) if you set `TURSO_DATABASE_URL` and `TURSO_AUTH_TOKEN` environment variables.
    - Uses `libsql` locally with file at `.data/db/sqlite.db` if no environment variables are set.
    ::
  :::
::

### Set SQL dialect

Enable the database in your `nuxt.config.ts` by setting the `db` property to your desired SQL dialect:

::tabs{sync="database-dialect"}
  :::tabs-item{label="PostgreSQL" icon="i-simple-icons-postgresql"}
  ```ts [nuxt.config.ts]
  export default defineNuxtConfig({
    hub: {
      db: 'postgresql'
    }
  })
  ```
  :::
  :::tabs-item{label="MySQL" icon="i-simple-icons-mysql"}
  ```ts [nuxt.config.ts]
  export default defineNuxtConfig({
    hub: {
      db: 'mysql'
    }
  })
  ```
  :::
  :::tabs-item{label="SQLite" icon="i-simple-icons-sqlite"}
  ```ts [nuxt.config.ts]
  export default defineNuxtConfig({
    hub: {
      db: 'sqlite'
    }
  })
  ```
  :::
::

### Database schema

Create your database schema with full TypeScript support using Drizzle ORM:

::tabs{sync="database-dialect"}
  :::tabs-item{label="PostgreSQL" icon="i-simple-icons-postgresql"}
    ```ts [server/db/schema.ts]
    import { pgTable, text, serial, timestamp } from 'drizzle-orm/pg-core'

    export const users = pgTable('users', {
      id: serial().primaryKey(),
      name: text().notNull(),
      email: text().notNull().unique(),
      password: text().notNull(),
      avatar: text().notNull(),
      createdAt: timestamp().notNull().defaultNow(),
    })
    ```
  :::

  :::tabs-item{label="MySQL" icon="i-simple-icons-mysql"}
    ```ts [server/db/schema.ts]
    import { mysqlTable, text, serial, timestamp } from 'drizzle-orm/mysql-core'

    export const users = mysqlTable('users', {
      id: serial().primaryKey(),
      name: text().notNull(),
      email: text().notNull().unique(),
      password: text().notNull(),
      avatar: text().notNull(),
      createdAt: timestamp().notNull().defaultNow(),
    })
    ```
  :::

  :::tabs-item{label="SQLite" icon="i-simple-icons-sqlite"}
    ```ts [server/db/schema.ts]
    import { sqliteTable, text, integer } from 'drizzle-orm/sqlite-core'

    export const users = sqliteTable('users', {
      id: integer().primaryKey({ autoIncrement: true }),
      name: text().notNull(),
      email: text().notNull().unique(),
      password: text().notNull(),
      avatar: text().notNull(),
      createdAt: integer({ mode: 'timestamp' }).notNull(),
    })
    ```
  :::
::

::callout{to="/docs/database/schema"}
Learn more about defining the **database schema files**.
::

### Generate migrations

Generate the database migrations from your schema:

```bash [Terminal]
npx nuxt db generate
```

This creates SQL migration files in `server/db/migrations/{dialect}/` which are automatically applied during deployment and development.

::tip{icon="i-lucide-rocket"}
That's it! You can now start your development server and query your database using the `db` instance from `hub:db`.
::

::important
Make sure to run `npx nuxt db generate` to generate the database migrations each time you change your database schema and restart the development server.
::

::

## Local development

During local development, view and edit your database from [Nuxt DevTools](https://devtools.nuxt.com) using the [Drizzle Studio](https://orm.drizzle.team/drizzle-studio/overview):

:img{src="/images/landing/nuxt-devtools-database.png" alt="Nuxt DevTools Database" width="915" height="515"}

::warning
At the moment, Drizzle Studio does not support SQLite.
::


## Build-time Hooks

::field-group
  ::field{name="'hub:db:migrations:dirs'" type="(dirs: string[]) => void | Promise<void>"}
    Add additional directories to scan for database migration files (.sql).

    ```ts [nuxt.config.ts]
    export default defineNuxtConfig({
      hooks: {
        'hub:db:migrations:dirs': (dirs) => {
          dirs.push('my-module/db/migrations')
        }
      }
    })
    ```
  ::
  ::field{name="'hub:db:queries:paths'" type="(queries: string[], dialect: string) => void | Promise<void>"}
    Add queries that are not tracked in the `_hub_migrations` table which are applied after the database migrations complete.

    ```ts [nuxt.config.ts]
    export default defineNuxtConfig({
      hooks: {
        'hub:db:queries:paths': (queries, dialect) => {
          queries.push('my-module/db/queries')
        }
      }
    })
    ```
  ::
  ::field{name="'hub:db:schema:extend'" type="({ paths: string[], dialect: string }) => void | Promise<void>"}
    Extend the database schema with additional files.

    ```ts [modules/my-module/index.ts]
    import { createResolver, defineNuxtModule } from '@nuxt/kit'

    export default defineNuxtModule({
      setup(options, nuxt) {
        const { resolve } = createResolver(import.meta.url)

        nuxt.hook('hub:db:schema:extend', ({ paths, dialect }) => {
          paths.push(resolve(`./db/schema/pages.${dialect}.ts`))
        })
      }
    })
    ```
  ::
::

::note{to="https://nuxt.com/docs/4.x/guide/going-further/hooks#nuxt-hooks-build-time"}
Learn more about Nuxt server hooks on the **Nuxt documentation**.
::

## Advanced configuration

For advanced use cases, you can explicitly configure the database connection:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  hub: {
    db: {
      dialect: 'postgresql',
      driver: 'postgres-js', // Optional: explicitly choose driver
      connection: {
        connectionString: process.env.DATABASE_URL
      }
    }
  }
})
```

### Column casing

Database model names often use `snake_case` conventions, while in TypeScript, it is common to use `camelCase` for naming models. To address this, you can use the `casing` option to automatically map camelCase JavaScript keys to snake_case in the database:

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  hub: {
    db: {
      dialect: 'postgresql',
      casing: 'snake_case'
    }
  }
})
```

This allows you to use camelCase in your TypeScript schema while Drizzle automatically maps them to snake_case in the database:

```ts [server/db/schema.ts]
import { pgTable, text, serial, timestamp } from 'drizzle-orm/pg-core'

export const users = pgTable('users', {
  id: serial().primaryKey(),
  firstName: text().notNull(), // Maps to first_name in the database
  lastName: text().notNull(),  // Maps to last_name in the database
  createdAt: timestamp().notNull().defaultNow() // Maps to created_at
})
```

::callout{to="https://orm.drizzle.team/docs/sql-schema-declaration#camel-and-snake-casing" external}
Learn more about [camel and snake casing](https://orm.drizzle.team/docs/sql-schema-declaration#camel-and-snake-casing) in Drizzle ORM.
::

### D1 over HTTP

Use the `d1-http` driver to access a Cloudflare D1 database over HTTP. This is useful when you want to query your D1 database when hosting on other platforms.

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  hub: {
    db: {
      dialect: 'sqlite',
      driver: 'd1-http'
    }
  }
})
```

This driver requires the following environment variables:

| Variable | Description |
| --- | --- |
| `NUXT_HUB_CLOUDFLARE_ACCOUNT_ID` | Your Cloudflare account ID |
| `NUXT_HUB_CLOUDFLARE_API_TOKEN` | A Cloudflare API token with D1 permissions |
| `NUXT_HUB_CLOUDFLARE_DATABASE_ID` | The ID of your D1 database |

::callout{icon="i-lucide-info"}
You can find your Cloudflare account ID and create API tokens in the [Cloudflare dashboard](https://dash.cloudflare.com). The API token needs `D1:Edit` permissions.
::

### Neon Serverless

Use the `neon-http` driver to connect to [Neon](https://neon.com) serverless PostgreSQL. This driver uses HTTP protocol optimized for serverless environments.

```ts [nuxt.config.ts]
export default defineNuxtConfig({
  hub: {
    db: {
      dialect: 'postgresql',
      driver: 'neon-http'
    }
  }
})
```

Install the required dependency:

```bash
pnpm add @neondatabase/serverless
```

This driver requires the following environment variable:

| Variable | Description |
| --- | --- |
| `DATABASE_URL` | Your Neon database connection string (or `POSTGRES_URL` / `POSTGRESQL_URL`) |

::callout{icon="i-lucide-info"}
You can find your Neon connection string in the [Neon dashboard](https://console.neon.tech). The connection string format is `postgresql://user:password@hostname/database`.
::

## AI Agents

If you work with an IDE that supports AI agents, you can add the following text in your `Agents.md` or `.cursor/rules` file:

```md
# Agent Instructions

/** ... your agent instructions ... */

## Database

- **Database Dialect**: The database dialect is set in the `nuxt.config.ts` file, within the `hub.db` option or `hub.db.dialect` property.
- **Drizzle Config**: Don't generate the `drizzle.config.ts` file manually, it is generated automatically by NuxtHub.
- **Generate Migrations**: Use `npx nuxt db generate` to automatically generate database migrations from schema changes
- **Never Write Manual Migrations**: Do not manually create SQL migration files in the `server/db/migrations/` directory
- **Workflow**:
  1. Create or modify the database schema in `server/db/schema.ts` or any other schema file in the `server/db/schema/` directory
  2. Run `npx nuxt db generate` to generate the migration
  3. Run `npx nuxt db migrate` to apply the migration to the database, or run `npx nuxt dev` to apply the migration during development
- **Access the database**: Use the `db` instance from `hub:db` to query the database, it is a Drizzle ORM instance.
```

## Migrating from v0.9

::important
**Breaking changes in NuxtHub v0.10:** If you're upgrading from a previous version that used `hubDatabase()`, follow this migration guide.
::

### Configuration changes

The `database` option has been renamed to `db` and now accepts a SQL dialect instead of a boolean.

```diff [nuxt.config.ts]
export default defineNuxtConfig({
  hub: {
-    database: true
+    db: 'sqlite'
  }
})
```

Valid dialects are `sqlite`, `postgresql` and `mysql`.

### Directory changes

The database directory has been renamed from `server/database/` to `server/db/`:

```diff
- server/database/schema.ts
+ server/db/schema.ts

- server/database/migrations/
+ server/db/migrations/
```

Make sure to move your schema and migration files to the new location.

### API changes

The old `hubDatabase()` function has been removed. You must now use Drizzle ORM.

**Before:**

```ts
const db = hubDatabase()
const result = await db.prepare('SELECT * FROM users').all()
```

**After:**
```ts
const result = await db.select().from(tables.users)
```

### Migration files

Your existing SQL migration files continue to work! Just move them to `server/db/migrations/`.
